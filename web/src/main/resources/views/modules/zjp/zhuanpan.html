

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no,viewport-fit=cover">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<link rel="stylesheet" href="${ctxStatic}/common/lottery.css">

<title>Roulette  </title>

</head>
<style>
	.ul1{ list-style: none; margin: 0; padding-left: 10px; color: #fff; }
	.ul1 span {margin: 0 1rem;}
     li{ padding: 5px; }
</style>
<body style="background-image: url(${ctxStatic}/images/choujiangbg.png); background-size: 100% 100%; -webkit-tap-highlight-color: rgba(0,0,0,0); ">

    <header style="height: 2rem; position: fixed; width: 100%; display: flex; justify-content: space-between; flex-direction: row; top: 0; max-width: 750px; left: 0; right: 0; margin: auto;text-align: center; z-index: 999; padding: 0 1rem; font-size: .8rem; color: white !important;">

        <div class="back" onclick="window.history.go(-1)" style="position: absolute; width: 1.75rem; height: 1.75rem; margin-top: 3%; bottom: -4px; left: .5rem; margin: auto; background-image: url(${ctxStatic}/images/back.png); background-size: 80%; background-repeat: no-repeat;"></div>
	   <span data-key="title" style="margin: auto; font-size: 1.5rem; display: inline-block; transform: scale(.8); padding-left: 1rem;">Roulette  </span>

        <div  onclick="his()"  style=" float: right; width: 10%; text-align: right; margin-right: 1rem; ">
            <a href="#"><img src="${ctxStatic}/images/liebiao.png" style=" width: 1.5rem; height: 1.5rem; margin-top: .51rem; margin-right: 1rem;"></a>
        </div>

    </header>

<div class='winnerBox' style="margin-top: 0;">

    <!-- 抽奖轮播 开始 -->
    <div style="background: linear-gradient(to right, #9857DC, #6167FF); margin: 15px 0px 30px 00px;display: none; height: 2.5rem; width: 100%; border-radius: 24px; font-family: initial;">
        <div style="position: relative; height: 1.85rem; line-height: 1.85rem; overflow: hidden; padding: .3rem .526666rem;">
            <marquee data-v-43c1797b="" behavior="scroll" class="ul1" id="ll" style="display: none">
            </marquee>
            
            
	<script id="data-ll" type="text/template">
				{{for(var i in it){}}
                <span> {{=it[i].content}} </span>

{{}}}
</script>
        </div>
    </div>
    <!-- 抽奖轮播 结束 -->
    

    <div class="turnplate_box">
        <canvas id="myCanvas" width="260px" height="260px">Se sentir désolé! Navigateur non pris en charge. <!--抱歉！浏览器不支持。--></canvas>
        <button id="tupBtn" class="turnplatw_btn">
            <img src="${ctxStatic}/images/guding@2x.png" class="turnplatw_img">
            <div class="goIcon"></div>
        </button>
    </div>

    <div class="border" style="
    width: 11.066667rem;
    height: 2.4rem;
    margin: 0rem auto 0.33333333rem;
    margin-top: .6rem;
    background: #e04949;
    font-size: 0.82rem;
    line-height: 2.4rem;
    text-align: center;
    color: #fff;
    border-radius: 1.6rem;
">
        Il vous reste <span id="change"> 0</span>  tirages
    </div>

    <div style="display: block; width: 90%; min-height: 9rem; background: #fff; margin: 0 auto; margin-top: .5rem; padding: .5rem 1rem; color: #fff; border-radius: 12px;">
        <div style="width: 65%; margin: 0 auto; background: linear-gradient(to right, #e5734c, #FD4302); text-align: center; margin-top: 1rem; margin-bottom: .5rem; padding: .5rem; border-radius: 1.5rem;">Introduction à la Roulette</div>
        <div style="height: 5rem; line-height: 1rem; background: #fff; border-radius: 10px; padding: .5rem; color: #214a7a; overflow: scroll; word-break: break-word;  line-height: 1.3rem;">
            Invitez des amis à rejoindre votre équipe et devenez un employé officiel VIP, vous aurez 1 chance de loterie à la roulette, bonne chance
        </div>
    </div>

	
</div>

<div id="zhezhao" style="position: absolute; top: 0%; left: 0%; width: 100%; height: 200%; background-color: black; z-index:1001; -moz-opacity: 0.7; opacity:.70;filter: alpha(opacity=70); display:none;"></div>    
<div id='tankuang' style='background: url(${ctxStatic}/images/lxbtank.png) no-repeat; background-size: 100%; width: 12rem; height: 12rem; margin: 0 auto; z-index: 9999; margin-top: -41rem; position: relative; display:none;'>
    <div class='close' style='background: url(${ctxStatic}/images/lxbclose.png) no-repeat; background-size: 1rem; background-position: 12rem; height: 1rem; width: 15rem; text-align: right;'></div>
    <div style="margin-top: 5rem; padding: 0 .6rem; color: #FF6A08; font-size: .68rem; font-family: Tahoma;"  id="msginfo"> </div>
    <div class="choice" style="width: 8.5rem; height: 1.85rem; margin: 0 auto; margin-top: .55rem;"> </div>
<!--    <div class='close' style="width: 8rem; height: 1.5rem; margin: 0 auto; margin-top: .18rem;"></div>-->
</div>

<!--当前页js-->
<script src="${ctxStatic}/common/jquery.min.js"></script>
<script type="text/javascript" src="${ctxStatic}/common/common.js"></script>

<script type="text/javascript"
	src="${ctxStatic}/jquery/jquery-1.12.4.min.js"></script>
	<script type="text/javascript" src="${ctxStatic}/layer/3.1/layer.js "></script>
	
	
<script >
    
    //旋转角度
var angles;

// 园的半径
var radius = 130;
//转盘初始化
var color = ["#fde284", "#fe9103", "rgba(0,0,0,0.5)", "#ffffff", "#b10105", "#fbc605"];
var winnerList=[
    {
        id:'1',
        name:'', //$0.1 -- 奖励金额
        logo:'${ctxStatic}/images/dollar1.png',
        probability:'', // 
        title : "0.1"
    },{
        id:'2',
        name:'', //$0.3 -- 奖励金额
        logo:'${ctxStatic}/images/dollar2.png',
        probability:'', // 
        title : "0.3"
    },{
        id:'3',
        name:'', //$0.5 -- 奖励金额
        logo:'${ctxStatic}/images/dollar3.png',
        probability:'', // 
        title : "0.5"
    },{
        id:'4',
        name:'', //$1 -- 奖励金额
        logo:'${ctxStatic}/images/dollar4.png',
        probability:'', // 
        title : "1"
    },{
        id:'5',
        name:'', //$1.5 -- 奖励金额
        logo:'${ctxStatic}/images/dollar5.png',
        probability:'', // 
        title : "1.5"
    },{
        id:'6',
        name:'', // $3 -- 奖励金额
        logo:'${ctxStatic}/images/dollar6.png',
        probability:'', // 
        title : "3"
    },{
        id:'7',
        name:'', // $5 -- 奖励金额
        logo:'${ctxStatic}/images/dollar7.png',
        probability:'', // 
        title : "5"
    },{
        id:'8',
        name:'', // $10 -- 奖励金额
        logo:'${ctxStatic}/images/dollar8.png',
        probability:'', // 
        title : "10"
    },{
        id:'9',
        name:'', // $50 -- 奖励金额
        logo:'${ctxStatic}/images/dollar9.png',
        probability:'', // 
        title : "50"
    }
] //奖品列表
// 有几份扇形
var number = winnerList.length;
$('#tupBtn').attr("disabled", true);

$(document).ready(function(){
      canvasRun();
      initData() ;
      
});

function initData(){
	var url =  "${ctxPath}/listHuoDongJiangli";
	
	doAjax(url,"post",{},function(data){
		var  flag  =  data.flag;
		if(flag == "true"){
			var change=  data.dqcs; 
			orderId=  data.orderId;
            $('#tupBtn').removeAttr("disabled", true);

			$("#change").html(change);
		}else {

			for(var i=0; i<9; i++){
				winnerList[i+1]['title'] = data.data[i]['jlje'];
			}
			layer.msg(data.msg)
		}
	})
}


var  orderId= "";
//绘制转盘
function canvasRun() {
    var canvas = document.getElementById('myCanvas');
    var ctx = canvas.getContext('2d');
    // canvas的实际渲染倍率
    var ratio =3.5 //清晰度
    canvas.style.width = canvas.width;
    canvas.style.height = canvas.height;
    canvas.width = canvas.width * ratio;
    canvas.height = canvas.height * ratio;
    createCircle(ratio);
    createCirText(ratio);
    //外圆
    function createCircle(ratio) {
        var startAngle = 0;//扇形的开始弧度
        var endAngle = 0;//扇形的终止弧度
        getCircleOffset();
        //画一个8等份扇形组成的圆形
        for (var i = 0; i < number; i++) {
            if(number % 4 == 0){
                startAngle = (Math.PI * 2 * i / number) - (Math.PI / number);
            }else if(number % 4 == 1 || number== 1 ){
                startAngle = (Math.PI * 2 * i / number)+(Math.PI/number/2);
            }else if(number % 4 == 2 || number == 2){
                startAngle = (Math.PI * 2 * i / number)
            }else if(number % 4 == 3 || number == 3){
                startAngle = (Math.PI * 2 * i / number)-(Math.PI/number/2);
            }else{
                startAngle = 0
            }
            endAngle = startAngle + Math.PI * 2 / number;
            ctx.save();
            ctx.beginPath();
            ctx.arc(radius*ratio, radius*ratio, radius*ratio, startAngle, endAngle, false);
            ctx.lineWidth = 220*ratio;
            if (i % 3 == 0) {
                ctx.strokeStyle = "#f8c950";
            } 
            else if (i % 3 == 1){
                ctx.strokeStyle = "#fbfbe0";
            } else {
                ctx.strokeStyle = "#9fc77d";
            }
            ctx.stroke();
            ctx.restore();
        }
    }

    //各奖项
    function createCirText(ratio) {
        ctx.textAlign = 'start';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = color[3];
        var step = 2 * Math.PI / number;
        for (var i = 0; i < number; i++) {
            (function (arg) {
                var img=new Image()
                img.src=winnerList[arg].logo
                img.onload = function() {
                    ctx.save();
                    ctx.scale(ratio,ratio);
                    ctx.beginPath();
                    ctx.translate(radius, radius);
                    ctx.rotate(arg * step);
                    ctx.font = "10px fantasy";
                    ctx.textAlign = 'center';
                    ctx.fillStyle = '#3c3b3b';
//                    ctx.fillText(winnerList[arg].name, 0, -70, 50);
                    ctx.drawImage(img,-26,-115,55,45);
                    ctx.closePath();
                    ctx.restore();
                }
                // 没有图片时也需要写文字
                img.onerror = function(){
                    ctx.save();
                    ctx.beginPath();
                    ctx.scale(ratio,ratio);
                    ctx.translate(radius, radius);
                    ctx.rotate(arg * step);
                    ctx.textAlign = 'center';
                    ctx.font = "8px Microsoft YaHei";
                    ctx.fillStyle = color[3];
                    ctx.fillText(winnerList[arg].name, 0, -110, 50);
                    ctx.closePath();
                    ctx.restore();
                }
            })(i)
        }
    }
    // 计算扇形的偏移量，以保证12点钟方向指向扇形区域的中间
    function getCircleOffset() {
        // 到12点钟方向的偏移量
        var offset = 0;
        // var verticalOffset = Math.PI / 2;
        if (number % 2 != 0) {
            offset = Math.PI * 2/number
        }
        if (number % 2 == 0 && number / 2 & 2 != 0) {
            offset = 0;
        } else {
        }
        return offset;
    }
}
    //转盘旋转
    function runCup(i,item) {
        var angles = i * (360 / number);
        if(angles == 90 || angles == 180 || angles == 270){
            angles = angles +1
        }
        
        $('#myCanvas').stopRotate();
        $('#myCanvas').rotate({
            angle:0,
            animateTo:2880 - angles,
            duration:5000,
            callback:function (){
            
			  // 抽奖结果显示--开始
//		       $('#zhezhao').show();
//	            $('#msginfo').html('Félicitations pour la récompense de 0.5$'); // 抽奖结果提示,需要根据抽奖结果变化
			  alert('Félicitations pour la récompense de '+item['title']+'$');
//	            $('#tankuang').show();
	
//	            setTimeout(function(){
//	                $('#zhezhao').hide();
//	                $('#tankuang').hide();
//	            }, 2500);
  			  // 抽奖结果显示--结束


                $('#tupBtn').removeAttr("disabled", true);
  			  
                initData();
            }
        });

    }

    //点击抽奖
    $(document).on('click','#tupBtn,.again',function(){
        //转盘旋转过程“开始抽奖”按钮无法点击
        $('#tupBtn').attr("disabled", true);
        // 中奖率randomRate
        var url =  "${ctxPath}/getHuoDongJiangLi";
		var parame = {
				orderId : orderId
		}
		doAjax(url,"post",parame,function(data){
			var  flag  =  data.flag;
				var change=  data.index; 

	        runCup(change, winnerList[change]);
	    })
    });

    //概率计算
    function rnd(rate){
        var random = Math.floor(Math.random() * 100);
        var myRandom = [];
        var randomList = [];
        var randomParent = [];
        for(var i = 0; i < 100; i++){
            myRandom.push(parseInt([i]) + 1);
        }
        for(var i = 0; i < rate.length; i++){
            var temp = [];
            var start = 0;
            var end = 0;
            randomList.push(parseInt(rate[i].split('%')[0]));
            for(var j = 0; j < randomList.length; j++){
                start += randomList[j-1] || 0
                end += randomList[j]
            }
            temp = myRandom.slice(start, end);
            randomParent.push(temp)
        }
        for(var i = 0; i < randomParent.length; i++){
            if($.inArray(random, randomParent[i]) > 0){
                return(i+1)
            }
        }
    }
    
    //getContents 
    var uu = "${ctxPath}/getContents";
    doAjax(uu,"post",{},function(data){
    	var  data  = data.data; 
    	//ll

		var dataTpl = doT.template(document
				.getElementById("data-ll").innerHTML);
    	$("#ll").html(dataTpl(data))
    	
    })

    function his(){
		location.href = "${ctxPath}/myChouJiangLog";

    }
</script>
<script src="${ctxStatic}/common/awardRotate.js"></script>
<script type="text/javascript" src="${ctxStatic}/common/doT.min.js"></script>

</body>
</html>